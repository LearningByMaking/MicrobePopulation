;ulogo file for $projectName

 constants [ [rpacket $1fc0] ]
 global [minTemp maxTemp]


 to ul-power
	 init-leds
	 redon
	 wait 10
	 redoff
 end
 
 to ul-init 
	redon	
	greenon 
        init-heaters	        
	wait 10	 
	redoff
	greenoff
     
 end

 to init-heaters
 	dp8output
        dp2output
 end
 
 to ul-go 
 	 greenon 
	 wait 10
	 greenoff
         wait 10
	 loop
	 [	
		blueon	
		collect-data
		wait 10 
		blueoff
		wait 100		
	 ]
 
 end


to collect-data
   init-packet 55  
   fprint readTemperature1  
   fprint readVoltatge1
   fprint readTemperature2  
   fprint readVoltatge2
   fprint readTemperature3  
   fprint readVoltatge3
   fprint readTemperature4  
   fprint readVoltatge4
   
   add-checksum
end


to readTemperature1
   output readADC 7
end

to readVoltatge1
   output readADC 6
end

to readTemperature2
   output readADC 5
end

to readVoltatge2
   output readADC 4
end

to readTemperature3
   output readADC 3
end

to readVoltatge3
   output readADC 2
end

to readTemperature4
   output readADC 1
end

to readVoltatge4
   output readADC 0
end


to calibrateADC :n 
   let [total 0]
   let [sample 10]
   repeat :sample	
   [
     let [adc (readADC :n)]
     let [total :total + :adc]
     print :adc      
     wait 10
   ]
   let [total :total / :sample]
   prs "Average:
   print :total
end




